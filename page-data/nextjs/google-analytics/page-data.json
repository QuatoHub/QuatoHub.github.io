{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/nextjs/google-analytics/",
    "result": {"data":{"posts":{"edges":[{"node":{"id":"ffc7da47-bfde-53c5-bd70-ff2fb28d6cd2","html":"<h1>들어가며</h1>\n<p>Next 프로젝트에서 react-ga 라이브러리 없이 <strong>Google Analytics를 적용하고 웹 사이트 조회수를 알아보는 방법</strong>에 대해 정리했습니다. React 프로젝트에서 GA를 적용할 때 <code>react-ga</code> 라이브러리를 가장 많이 사용한다고 합니다. 그런데 GA 추적 코드 형식이 <code>UA-XXXXXXXXX-X</code>에서 <code>G-XXXXXXXXXX</code>으로 변경된 후 <code>react-ga</code>에서 최신 추적 코드 형식을 지원하지 않고 있습니다. 따라서 라이브러리 없이 GA를 적용하고 총 5단계로 정리했습니다. <code>Next.js</code> 프로젝트이며 <code>TypeScript</code>를 사용했습니다. 배포 환경은 <code>Vercel</code>입니다.</p>\n<h2>[1] .env.local 파일에 Google Analytics 추적 코드 작성하기</h2>\n<p><code>.env.local</code> 파일에 GA 추적 코드를 작성하기 전, 주의하실 점이 있습니다.</p>\n<blockquote>\n<p>바로 <code>.gitignore</code> 파일에 <code>.env.local</code> 파일이 적혀있는지 확인하는 것입니다.</p>\n</blockquote>\n<p><code>.gitignore</code> 파일에 기본적으로 <code>.env.local</code> 파일이 적혀있지만, 실수로 <code>.env.local</code> 파일을 commit 할 일 없도록 다시 한번 확인하시는 것을 추천합니다. GA 추적 코드를 “code”라고 할 때 <code>.env.local</code> 파일에 다음과 같이 작성해주시면 됩니다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"seti\"  >\n          <code slot=\"code\">NEXT_PUBLIC_GOOGLE_ANALYTICS=&quot;code&quot;</code>\n        </deckgo-highlight-code>\n<h2>[2] _document.tsx 파일에 Google Analytics Code 추가하기</h2>\n<p><code>pages</code> 폴더 <code>_document.tsx</code> 파일에 다음과 같이 코드를 추가하면 GA 추적 코드를 설정할 수 있습니다. JavaScript 프로젝트에서도 같은 코드를 작성해주시면 됩니다.</p>\n<p><strong>pages/_document.tsx</strong></p>\n<deckgo-highlight-code language=\"tsx\" terminal=\"carbon\" theme=\"seti\"  >\n          <code slot=\"code\">return (\n  &lt;Html&gt;\n    &lt;Head&gt;\n      &lt;script\n        async\n        src={`https://www.googletagmanager.com/gtag/js?id=${process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS}`}\n      /&gt;\n      &lt;script\n        dangerouslySetInnerHTML={{\n          __html: `\n        window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);}\n        gtag(&#39;js&#39;, new Date());\n        gtag(&#39;config&#39;, &#39;${process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS}&#39;, {\n          page_path: window.location.pathname,\n        });\n      `,\n        }}\n      /&gt;\n    &lt;/Head&gt;\n    &lt;body&gt;\n      &lt;Main /&gt;\n      &lt;NextScript /&gt;\n    &lt;/body&gt;\n  &lt;/Html&gt;\n);</code>\n        </deckgo-highlight-code>\n<h2>[3] 조회수를 측정하는 함수 생성하기</h2>\n<p><code>lib/ga</code> 폴더 <code>index.ts</code> 파일에 함수를 생성합니다. TypeScript에서 <code>window</code> 객체에 <code>property</code>를 추가할 때 타입을 정의하지 않으면 에러가 발생합니다. 다양한 방법으로 에러를 해결할 수 있지만, 그중 전역 타입을 확장해서 해결하는 방법을 사용했습니다.</p>\n<p><strong>lib/ga/index.ts</strong></p>\n<deckgo-highlight-code language=\"ts\" terminal=\"carbon\" theme=\"seti\"  >\n          <code slot=\"code\">declare global {\n  interface Window {\n    gtag: (param1: string, param2: string, param3: object) =&gt; void;\n  }\n}\n\nexport const pageview = url =&gt; {\n  window.gtag(&#39;config&#39;, process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS, {\n    page_path: url,\n  });\n};</code>\n        </deckgo-highlight-code>\n<p>JavaScript 프로젝트에서는 타입 정의 부분을 제외하고 다음과 같이 작성하시면 됩니다.</p>\n<p><strong>lib/ga/index.js</strong></p>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"seti\"  >\n          <code slot=\"code\">export const pageview = url =&gt; {\n  window.gtag(&#39;config&#39;, process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS, {\n    page_path: url,\n  });\n};</code>\n        </deckgo-highlight-code>\n<h2>[4] 조회수 측정하기</h2>\n<p><code>pages</code> 폴더 <code>_app.tsx</code> 파일에 다음과 같이 코드를 추가하면 페이지 조회수를 측정할 수 있습니다.</p>\n<p><strong>pages/_app.tsx</strong></p>\n<deckgo-highlight-code language=\"tsx\" terminal=\"carbon\" theme=\"seti\"  >\n          <code slot=\"code\">import { useEffect } from &#39;react&#39;;\nimport { useRouter } from &#39;next/router&#39;;\nimport type { AppProps } from &#39;next/app&#39;;\n\nimport * as ga from &#39;../lib/ga&#39;;\n\nfunction App({ Component, pageProps }: AppProps) {\n  const router = useRouter();\n\n  useEffect(() =&gt; {\n    const handleRouteChange = url =&gt; {\n      ga.pageview(url);\n    };\n    router.events.on(&#39;routeChangeComplete&#39;, handleRouteChange);\n\n    return () =&gt; {\n      router.events.off(&#39;routeChangeComplete&#39;, handleRouteChange);\n    };\n  }, [router.events]);\n\n  return &lt;Component {...pageProps} /&gt;;\n}\n\nexport default App;</code>\n        </deckgo-highlight-code>\n<p>JavaScript 프로젝트에서는 AppProps 부분을 제외하고 다음과 같이 작성하시면 됩니다.</p>\n<p><strong>pages/_app.jsx</strong></p>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"seti\"  >\n          <code slot=\"code\">import { useEffect } from &#39;react&#39;;\nimport { useRouter } from &#39;next/router&#39;;\n\nimport * as ga from &#39;../lib/ga&#39;;\n\nfunction App({ Component, pageProps }) {\n  const router = useRouter();\n\n  useEffect(() =&gt; {\n    const handleRouteChange = url =&gt; {\n      ga.pageview(url);\n    };\n    router.events.on(&#39;routeChangeComplete&#39;, handleRouteChange);\n\n    return () =&gt; {\n      router.events.off(&#39;routeChangeComplete&#39;, handleRouteChange);\n    };\n  }, [router.events]);\n\n  return &lt;Component {...pageProps} /&gt;;\n}\n\nexport default App;</code>\n        </deckgo-highlight-code>\n<h2>[5] 배포 설정에서 환경 변수 추가하기</h2>\n<p><code>.env.local</code> 파일에 작성한 GA 추적 코드를 배포 환경에 추가해야 합니다. vercel 배포 환경에서는 <code>Settings > Environment Variables</code> 항목 중 NAME, VALUE를 작성해야 합니다. NAME에는 <code>NEXT_PUBLIC_GOOGLE_ANALYTICS</code>를, VALUE에는 <code>GA 추적 코드</code>를 작성하시면 됩니다. 1번 NEXT_PUBLIC_GOOGLE_ANALYTICS=“code”에서 작성한 “code” 값과 같습니다.</p>\n<p><img src=\"https://images.velog.io/images/mnz/post/22c0a310-86d8-44db-b544-9eb623a56be9/image.png\" alt=\"vercel\"></p>\n<h1>마치며</h1>\n<p>이렇게 5단계까지 완료하면 Google Analytics에서 사이트 조회수를 측정할 수 있습니다. 🤗 사용자가 입력한 검색어와 같은 이벤트 측정 기능 생성 방법이 궁금하시다면 <a href=\"https://mariestarck.com/add-google-analytics-to-your-next-js-application-in-5-easy-steps/\" target=\"_blank\" rel=\"nofollow\">Add Google Analytics to your Next.js application in 5 easy steps</a>에서 상세 내용을 확인하시는 걸 추천합니다!</p>\n<hr />\n<h3>참고 자료 📩</h3>\n<ul>\n<li>\n<p><a href=\"https://mariestarck.com/add-google-analytics-to-your-next-js-application-in-5-easy-steps/\" target=\"_blank\" rel=\"nofollow\">Add Google Analytics to your Next.js application in 5 easy steps</a></p>\n</li>\n<li>\n<p><a href=\"https://velog.io/@kineo2k/Typescript%EC%97%90%EC%84%9C-window-%EA%B0%9D%EC%B2%B4%EC%97%90-property-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" target=\"_blank\" rel=\"nofollow\">Typescript에서 window 객체에 property 추가하기</a></p>\n</li>\n</ul>","timeToRead":3,"frontmatter":{"title":"[NextJS] Next 프로젝트에서 Google Analytics 적용하기","summary":"Next 프로젝트에서 react-ga 라이브러리 없이 Google Analytics를 적용하고 웹 사이트 조회수를 알아보는 방법에 대해 정리했습니다.","date":"31 August, 2021","category":"NextJS","thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAClElEQVQozyXM21IaBwCA4X2EznSmEzVaggzoclgKwYhpDA4bQE7LihAXMMtBgiIVVo67HEuSphehM20v2j7t35nk4rv9hOVyxfrDJ+bLNdZ8xefPv7P58oWPHz+RVYvIiSxJ5ZJsXqNQqlKqttD0JqVai+tmm+ubNuXGHW/1JvlyHUFvdtBbHW7uDe56I6bLNX9sNmw2G27et0nliqjFMmqhTFIpEIkmiKVU4ukL5HOFo5MIUuAY0RPEvn+IkFaLpAslSo07brsDcm/LpHMqXcMglVHwSwFcLjcOxwFBrwevy0k8Fmd76yk22z6iS8Rpt2Pf3WPvyTZC8Urj6l2Dvrmg1RsiJzPYD9wc+vx0fnmgrldJxOIo6Qyjzi2akuEyp5BT88hRmZgcQY4cE5fP8B26EfIXeWKpLLcPfS60Cj+fRTnwSLhED7VGk/VqxftanXpJYz40uC7kOT0KsfrwG4PRGKfNxv7uLolYgkpFR4jLb0hlsoTCYZxu71fBFyf4Qy8QfX4KhQK5TJpjr0jyNEzY7+P06DmT2YLe4wCHzYZte5tkPMbYnCIEfBLqxSV7NjtPnznY2n3GmRzDeBzw519/88+//2GaFtZ4xMwc89C+o1qp0L2/57Uk4vr+O3w/7vCuVGQ2XyDs/PCEbEZha2cP6acgV1cak4mJac3Q602isXMkKUAwECKVVqjVb9C0CrlMlkTkNa+8HopZhZG1wJwuEHziITVd57E/ZDqb03nokc7lCYRO8EjPCYaOOXl5ipov0mi16fT6DM0Z1nKNufgVY2zRHZoMJ1PM6RLhPPoKNXNOtVZHLWi8jLzB7QvgcIoEQ2GKpWs6xgBjZH7N7ruPGMMJg4nFyJwynFj0x9/CibXgfwjIixlv2SmBAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/4107247d1d1486ea9e84689bc9386d4e/25b42/google-analytics.png","srcSet":"/static/4107247d1d1486ea9e84689bc9386d4e/f144d/google-analytics.png 183w,\n/static/4107247d1d1486ea9e84689bc9386d4e/50beb/google-analytics.png 365w,\n/static/4107247d1d1486ea9e84689bc9386d4e/25b42/google-analytics.png 730w","sizes":"(min-width: 730px) 730px, 100vw"},"sources":[{"srcSet":"/static/4107247d1d1486ea9e84689bc9386d4e/c97dd/google-analytics.webp 183w,\n/static/4107247d1d1486ea9e84689bc9386d4e/2772f/google-analytics.webp 365w,\n/static/4107247d1d1486ea9e84689bc9386d4e/c85f2/google-analytics.webp 730w","type":"image/webp","sizes":"(min-width: 730px) 730px, 100vw"}]},"width":730,"height":365}},"publicURL":"/static/4107247d1d1486ea9e84689bc9386d4e/google-analytics.png"}}}}]}},"pageContext":{"slug":"/nextjs/google-analytics/"}},
    "staticQueryHashes": ["2368566813","3026479947","3227158195","413061808"]}